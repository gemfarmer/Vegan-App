// Generated by CoffeeScript 1.6.3
(function() {
  var socket;

  socket = io.connect();

  $(function() {
    $(".chzn-select").chosen();
    $('#substitute-params').hide();
    return socket.on('connect', function() {
      $('#substitution-form').on('click', '.substitution-submit', function(e) {
        var formData;
        console.log();
        e.preventDefault();
        formData = $(this).serialize();
        return console.log("formData", formData);
      });
      return $('#substitution-form').on('change', function(e) {
        var val;
        e.preventDefault();
        val = $(this).serialize();
        console.log("val", val);
        socket.emit('requestparams', val);
        $('#substitute-params').show();
        return socket.on('sendparams', function(data) {
          var ArraytoPush, QtyToPush, UnitsToPush, consolidatedQty, consolidatedUnits, i, item, items, pushedArray, toAppend, uniqueQty, uniqueUnits, _i, _j, _k, _len, _len1, _len2;
          console.log("sendparms:::", data);
          $('.subs').empty();
          console.log("adfasdfasdf", data);
          pushedArray = [];
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            item = data[_i];
            UnitsToPush = item['non-vegan-units'];
            QtyToPush = item['non-vegan-qty'];
            ArraytoPush = [UnitsToPush, QtyToPush];
            pushedArray.push(ArraytoPush);
          }
          console.log("pushedArray", pushedArray);
          toAppend = _.flatten(pushedArray);
          consolidatedUnits = (function() {
            var _j, _len1, _results;
            _results = [];
            for (_j = 0, _len1 = toAppend.length; _j < _len1; _j += 2) {
              i = toAppend[_j];
              _results.push(i);
            }
            return _results;
          })();
          consolidatedQty = _.difference(toAppend, consolidatedUnits);
          uniqueUnits = _.uniq(consolidatedUnits);
          uniqueQty = _.uniq(consolidatedQty);
          for (_j = 0, _len1 = uniqueUnits.length; _j < _len1; _j++) {
            items = uniqueUnits[_j];
            $('#substitute-params #units').append("<option data-placeholder='units' value=" + items + ">" + items + "</option>");
            $('#units').trigger("chosen:updated");
          }
          for (_k = 0, _len2 = uniqueQty.length; _k < _len2; _k++) {
            items = uniqueQty[_k];
            console.log("items:::", items);
            $('#substitute-params #qty').append("<option data-placeholder='units' value=" + items + ">" + items + "</option>");
            $('#qty').trigger("chosen:updated");
          }
          return $(document).on('click', '.substitution-submit', function(e) {
            var dataDescription, dataForRow, dataItem, dataQty, dataUnits, itemset, newArray, newRow, vegDescription, vegItems, vegQty, vegUnits, _l, _len3, _len4, _m, _results;
            e.preventDefault();
            console.log("daat", data);
            $('#substitute-results').empty();
            _results = [];
            for (_l = 0, _len3 = data.length; _l < _len3; _l++) {
              item = data[_l];
              $('#NonItem').text(item['non-vegan-item']);
              $('#NonQty').text(item['non-vegan-qty']);
              $('#NonUnits').text(item['non-vegan-units']);
              vegItems = item['vegan-substitute'];
              vegUnits = item['substitute-units'];
              vegQty = item['substitute-qty'];
              vegDescription = item['substitute-description'];
              newArray = _.zip(vegItems, vegUnits, vegQty, vegDescription);
              console.log(newArray);
              for (_m = 0, _len4 = newArray.length; _m < _len4; _m++) {
                itemset = newArray[_m];
                console.log("itemset", itemset);
                dataItem = "<td>" + itemset[0] + "</td>";
                dataUnits = "<td>" + itemset[1] + "</td>";
                dataQty = "<td>" + itemset[2] + "</td>";
                dataDescription = "<td>" + itemset[3] + "</td>";
                dataForRow = dataItem + dataUnits + dataQty + dataDescription;
                newRow = "<tr>" + dataForRow + "</tr>";
              }
              _results.push($('#substitute-results').append(newRow));
            }
            return _results;
          });
        });
      });
    });
  });

}).call(this);
